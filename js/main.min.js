/**
 * Created by jurez on 11/20/14.
 */
$(document).ready(function(){function a(){if($.trim($("#customCanSize").val())==""&&$("#selectCanSize").prop("selectedIndex")==0){return false}else{return true}}function f(){console.log("clear all fields");console.log("selectedProductId: "+e);console.log("selectedCollectionId: "+t);console.log("selectedFormulaId: "+n);console.log("selectedCansizeId: "+r);console.log("selectedColorName: "+i);console.log("globalColorantsForColor: "+o);console.log("globalColorDetails: "+u);console.log("startFrom: "+s);e=-1;t=-1;n=-1;r=-1;i="";s="";c();h();p();$("#selectColor").val("");$("#customCanSize").val("");l()}function l(){var e="";e+="<div class='colorInfo'>";e+="<p class='productName'>Product: -</p>";e+="<p class='elementName'>Collection: -</p>";e+="<p class='elementName'>Color name: -</p>";e+="<div class='approximateColor clearFix'>";e+="<div class='selectedColor' style='background-color: #000000'>&nbsp;</div>";e+="</div>";e+="<p class='elementName'>Substrat: -</p>";e+="<div class='warningInfo'>";e+="<p>Comment:</p>";e+="<p>-</p>";e+="</div>";e+="<div class='warningInfo'>";e+="<p>Warning:</p>";e+="<p>-</p>";e+="</div>";e+="</div>";var t="";t+="<div class='row priceAndInfo'>";t+="<div class='infoBtn left' id='showPriceInfoPopup' ><img src='images/moreInfoIconV3.svg'></div>";t+="<div class='bigPrice left'>-</div>";t+="</div>";t+="<div class='components'>";t+="<div class='row tableHeader'>";t+="<div class='left compNameHeader'><p>Component Name</p></div>";t+="<div class='left compAmount'><p>Amount</p></div>";t+="<div class='left compPrice'><p>Price</p></div>";t+="</div>";t+="<div class='colorantList'>";t+="<div class='row base'>";t+="<div class='left compColor'>&nbsp;</div>";t+="<div class='left compName'><p>Base NAME</p></div>";t+="<div class='left compAmount'><p>-</p></div>";t+="<div class='left compPrice'><p>-</p></div>";t+="</div>";for(var n=0;n<6;n++){t+="<div class='row'>";t+="<div class='left compColor'><div class='colorantColor'>&nbsp;</div></div>";t+="<div class='left compName'><p>Colorant Name</p></div>";t+="<div class='left compAmount'><p>-</p></div>";t+="<div class='left compPrice'><p>-</p></div>";t+="</div>"}t+="</div>";t+="</div>";var r="";for(var n=0;n<6;n++){r+="<div class='colorSwatch left'>";r+="<div class='colorSwatchName'>COLORNAME"+n+"</div>";r+="</div>"}$(".colorDetail").html(e);$(".componentsList").html(t);$(".availableColorsHideScroller").html(r);$(".colorDetailMain").css("border-color","#000000");$("#showPriceInfoPopup").click(function(){if(a()){$("#priceInfoPopup").fadeIn()}else{$("#selectCanSizeError").fadeIn()}});o=[];u=[]}function c(){var t=$.post("includes/ajaxCalls/updateCollectionOptions.php",{productId:e});t.success(function(e){$("#selectCollection").html(e)})}function h(){var e=$.post("includes/ajaxCalls/updateProductOptions.php",{collectionId:t});e.success(function(e){$("#selectProduct").html(e)})}function p(){var t=$.post("includes/ajaxCalls/updateCanSizeOptions.php",{productId:e});t.success(function(e){$("#selectCanSize").html(e)})}function d(n){var r=$.post("includes/ajaxCalls/findProductsAndCollectionsForColor.php",{colorName:n});r.success(function(r){var i=$.parseJSON(r);if(i[0].length==1&&i[1].length==1){e=i[0][0].id;t=i[1][0].id;$("#selectProduct").html("<option value='"+e+"'>"+i[0][0].name+"</option>");$("#selectCollection").html("<option value='"+t+"'>"+i[1][0].name+"</option>");y(n)}else{$("#pRadioBtns").html(g(i[0],"product"));$("#cRadioBtns").html(g(i[1],"collection"));$("#colorSearchResults").toggle("slide",{direction:"left"})}console.log(i[0]);console.log(i[1]);console.log(i.length)})}function v(n){var r=$.post("includes/ajaxCalls/findCollectionsForColorAndProduct.php",{colorName:n,productId:e});r.success(function(e){var n=$.parseJSON(e);if(n.length==1){console.log("should work");$("#selectCollection").val(n[0].id);t=n[0].id;y(i)}else{$("#productRadioBtns").html(g(n,"collection"));$("#colorSearchResultsForProduct").toggle("slide",{direction:"left"})}})}function m(n){var r=$.post("includes/ajaxCalls/findProductsForColorAndCollection.php",{colorName:n,collectionId:t});r.success(function(t){var n=$.parseJSON(t);if(n.length==1){$("#selectProduct").val(n[0].id);e=n[0].id;y(i)}else{$("#collectionRadioBtns").html(g(n,"product"));$("#colorSearchResultsForCollection").toggle("slide",{direction:"left"})}})}function g(e,t){var n="";if(e.length==1){n+="<div class='rbLine'>";n+="<input type='radio' name='"+t+"' id='"+e[0].id+"' value='"+e[0].id+"' checked>";n+="<label for='"+e[0].id+"'>"+e[0].name+"</label>";n+="</div>";return n}else{for(var r=0;r<e.length;r++){n+="<div class='rbLine'>";n+="<input type='radio' name='"+t+"' id='"+e[r].id+"' value='"+e[r].id+"'>";n+="<label for='"+e[r].id+"'>"+e[r].name+"</label>";n+="</div>"}return n}}function y(r){var i=$.post("includes/ajaxCalls/findFormulaIdForColorProductCollection.php",{colorName:r,productId:e,collectionId:t});i.success(function(e){var t=$.parseJSON(e);n=t["formulas_id"];b()})}function b(){console.log("... updating color details..");console.log("selectedProductId: "+e);console.log("selectedCollectionId: "+t);console.log("selectedFormulaId: "+n);console.log("selectedCansizeId: "+r);console.log("selectedColorName: "+i);console.log("startFrom: "+s);console.log("... updating color details..");var o=$.post("includes/ajaxCalls/findDataForSelectedColor.php",{productId:e,collectionId:t,formulaId:n});o.success(function(e){var t=$.parseJSON(e);w(t)})}function w(e){u=e["colorData"];o=e["colorantData"];var t=e["colorData"];var n=e["colorantData"];var r=N(t["colorR"],t["colorG"],t["colorB"]);var i="";i+="<div class='colorInfo'>";i+="<p class='productName'>Product: "+t["productName"]+"</p>";i+="<p class='elementName'>Collection: "+t["collectionName"]+"</p>";i+="<p class='elementName'>Color name: "+t["colorName"]+"</p>";i+="<div class='approximateColor clearFix'>";i+="<div class='selectedColor' style='background-color: #"+r+"'>&nbsp;</div>";i+="</div>";i+="<p class='elementName'>Substrat: "+t["sustrate"]+"</p>";i+="<div class='warningInfo'>";i+="<p>Comment:</p>";i+="<p>"+t["COMMENTS"]+"</p>";i+="</div>";i+="<div class='warningInfo'>";i+="<p>Warning:</p>";i+="<p>"+t["WARNING_MESSAGE"]+"</p>";i+="</div>";i+="</div>";var s="";var f=t["baseName"].substr(t["baseName"].length-6);s+="<div class='row priceAndInfo'>";s+="<div class='infoBtn left' id='showPriceInfoPopup' ><img src='images/moreInfoIconV3.svg'></div>";s+="<div class='bigPrice left'>-</div>";s+="</div>";s+="<div class='components'>";s+="<div class='row tableHeader'>";s+="<div class='left compNameHeader'><p>Component Name</p></div>";s+="<div class='left compAmount'><p>Amount</p></div>";s+="<div class='left compPrice'><p>Price</p></div>";s+="</div>";s+="<div class='colorantList'>";s+="<div class='row base'>";s+="<div class='left compColor'>&nbsp;</div>";s+="<div class='left compName'><p>"+f+"</p></div>";s+="<div class='left compAmount'><p>-</p></div>";s+="<div class='left compPrice'><p>-</p></div>";s+="</div>";for(var l=0;l<n.length;l++){var c=N(n[l]["colorantR"],n[l]["colorantG"],n[l]["colorantB"]);s+="<div class='row'>";s+="<div class='left compColor'><div class='colorantColor' style='background-color: #"+c+"'>&nbsp;</div></div>";s+="<div class='left compName'><p>"+n[l]["name"]+"</p></div>";s+="<div class='left compAmount'><p>-</p></div>";s+="<div class='left compPrice'><p>-</p></div>";s+="</div>"}s+="</div>";s+="</div>";$(".colorDetail").html(i);$(".componentsList").html(s);$(".colorDetailMain").css("border-color","#"+r);$("#showPriceInfoPopup").click(function(){if(a()){$("#priceInfoPopup").fadeIn()}else{$("#selectCanSizeError").fadeIn()}})}function E(e,t){return(Math.random()*(t-e+1)+e).toFixed(2)}function S(){var e=1.2;var t=E(40,90);var n=(t*e).toFixed(2);var r=(n-t).toFixed(2);var i=o;var s=u;console.log(i);console.log(i.length);var f=s["baseName"].substr(s["baseName"].length-6);var l="";l+="<div class='row priceAndInfo'>";l+="<div class='infoBtn left' id='showPriceInfoPopup' ><img src='images/moreInfoIconV3.svg'></div>";l+="<div class='bigPrice left'>€"+n+"</div>";l+="</div>";l+="<div class='components'>";l+="<div class='row tableHeader'>";l+="<div class='left compNameHeader'><p>Component Name</p></div>";l+="<div class='left compAmount'><p>Amount</p></div>";l+="<div class='left compPrice'><p>Price</p></div>";l+="</div>";l+="<div class='colorantList'>";l+="<div class='row base'>";l+="<div class='left compColor'>&nbsp;</div>";l+="<div class='left compName'><p>"+f+"</p></div>";l+="<div class='left compAmount'><p>"+$("#selectCanSize option:selected").text()+"</p></div>";l+="<div class='left compPrice'><p>€"+n*.5+"</p></div>";l+="</div>";var c=n*.5/i.length;for(var h=0;h<i.length;h++){var p=N(i[h]["colorantR"],i[h]["colorantG"],i[h]["colorantB"]);l+="<div class='row'>";l+="<div class='left compColor'><div class='colorantColor' style='background-color: #"+p+"'>&nbsp;</div></div>";l+="<div class='left compName'><p>"+i[h]["name"]+"</p></div>";l+="<div class='left compAmount'><p>"+E(.1,2)+"</p></div>";l+="<div class='left compPrice'><p>€"+c.toFixed(2)+"</p></div>";l+="</div>"}l+="</div>";l+="</div>";var d="";d+="<div class='row clearFix'>";d+="<div class='propertyName left'>Price Excluding VAT</div>";d+="<div class='propertyValue left'>€"+t+"</div>";d+="</div>";d+="<div class='row clearFix'>";d+="<div class='propertyName left'>VAT</div>";d+="<div class='propertyValue left'>€"+r+"</div>";d+="</div>";d+="<div class='row clearFix'>";d+="<div class='propertyName left'>VAT Rate</div>";d+="<div class='propertyValue left'>20%</div>";d+="</div>";d+="<div class='row clearFix'>";d+="<div class='propertyName left'>Price Group</div>";d+="<div class='propertyValue left'>I - IV</div>";d+="</div>";d+="<div class='row clearFix'>";d+="<div class='propertyName left'>Pricelist</div>";d+="<div class='propertyValue left'>Testni cenik</div>";d+="</div>";d+="<div class='closeBtn button' id='closePriceInfoPopup'>Close</div>";$("#priceInfoPopup").html(d);$("#closePriceInfoPopup").click(function(){$("#priceInfoPopup").fadeOut()});$(".componentsList").html(l);$("#showPriceInfoPopup").click(function(){if(a()){$("#priceInfoPopup").fadeIn()}else{$("#selectCanSizeError").fadeIn()}})}function x(){var r=$.post("includes/ajaxCalls/findPricesAndQuantities.php",{productId:e,collectionId:t,formulaId:n});r.success(function(e){var t=$.parseJSON(e)})}function T(){var e=o;var t=u;var n=t["baseName"].substr(t["baseName"].length-6);var r="";r+="<div class='row priceAndInfo'>";r+="<div class='infoBtn left' id='showPriceInfoPopup' ><img src='images/moreInfoIconV3.svg'></div>";r+="<div class='bigPrice left'>-</div>";r+="</div>";r+="<div class='components'>";r+="<div class='row tableHeader'>";r+="<div class='left compNameHeader'><p>Component Name</p></div>";r+="<div class='left compAmount'><p>Amount</p></div>";r+="<div class='left compPrice'><p>Price</p></div>";r+="</div>";r+="<div class='colorantList'>";r+="<div class='row base'>";r+="<div class='left compColor'>&nbsp;</div>";r+="<div class='left compName'><p>"+n+"</p></div>";r+="<div class='left compAmount'><p>-</p></div>";r+="<div class='left compPrice'><p>-</p></div>";r+="</div>";for(var i=0;i<e.length;i++){var s=N(e[i]["colorantR"],e[i]["colorantG"],e[i]["colorantB"]);r+="<div class='row'>";r+="<div class='left compColor'><div class='colorantColor' style='background-color: #"+s+"'>&nbsp;</div></div>";r+="<div class='left compName'><p>"+e[i]["name"]+"</p></div>";r+="<div class='left compAmount'><p>-</p></div>";r+="<div class='left compPrice'><p>-</p></div>";r+="</div>"}r+="</div>";r+="</div>";$(".componentsList").html(r);$("#showPriceInfoPopup").click(function(){if(a()){$("#priceInfoPopup").fadeIn()}else{$("#selectCanSizeError").fadeIn()}})}function N(e,t,n){var r=parseInt(e).toString(16);var i=parseInt(t).toString(16);var s=parseInt(n).toString(16);r=r.length<2?"0"+r:r;i=i.length<2?"0"+i:i;s=s.length<2?"0"+s:s;return r+i+s}function C(){var r=$.post("includes/ajaxCalls/findAvailableColors.php",{productId:e,collectionId:t,formulaId:n});r.success(function(e){$(".availableColorsHideScroller").html(e)})}f();var e=-1;var t=-1;var n=-1;var r=-1;var i="";var s="";var o=[];var u=[];$("#resetAllSearchFields").click(function(){f()});$("#clearColorsSearch").click(function(){$("#selectColor").val("");i="";if(s=="color"){console.log("deleteing start from");f()}else{l()}});$("#selectProduct").change(function(){if(e==-1&&n==-1&&t==-1){s="product"}e=this.value;console.log(this.value);if(s=="product"){c()}p();if(e==-1&&s=="product"){s=""}if(e!=-1){C()}$("#selectColor").val("");l()});$("#selectCollection").change(function(){if(e==-1&&n==-1&&t==-1){s="collection"}t=this.value;console.log(this.value);if(s=="collection"){h()}if(t==-1&&s=="collection"){s=""}if(t!=-1){C()}$("#selectColor").val("");l()});$("#selectColor").autocomplete({source:function(n,r){$.ajax({url:"includes/ajaxCalls/findAppropriateColors.php",dataType:"json",data:{term:n.term,productId:e,collectionId:t},success:function(e){console.log("data je");console.log(e);r(e)}})},minLength:0,select:function(r,o){if(e==-1&&n==-1&&t==-1){s="color"}i=o.item.label;if(e==-1&&t==-1){d(i)}else if(e!=-1&&t==-1){v(i)}else if(e==-1&&t!=-1){m(i)}else{y(i)}console.log(o.item.label)}});$("#cancelSearchResultsC, #closeSearchResultsWithArrowC").click(function(){$("#colorSearchResultsForCollection").toggle("slide",{direction:"left"});$("#selectColor").val("");i=""});$("#cancelSearchResultsP, #closeSearchResultsWithArrowP").click(function(){$("#colorSearchResultsForProduct").toggle("slide",{direction:"left"});$("#selectColor").val("");i=""});$("#cancelSearchResults, #closeSearchResultsWithArrow").click(function(){$("#colorSearchResults").toggle("slide",{direction:"left"});$("#selectColor").val("");i=""});$("#okSearchResultsForCollection").click(function(){if($("input:radio[name='product']").is(":checked")){e=$("input[name='product']:checked").val();$("#selectProduct").val(e);y(i)}else{$("#selectColor").val("");i=""}$("#colorSearchResultsForCollection").toggle("slide",{direction:"left"})});$("#okSearchResultsForProduct").click(function(){if($("input:radio[name='collection']").is(":checked")){t=$("input[name='collection']:checked").val();$("#selectCollection").val(t);y(i)}else{$("#selectColor").val("");i=""}$("#colorSearchResultsForProduct").toggle("slide",{direction:"left"})});$("#okSearchResults").click(function(){if($("input:radio[name='product']").is(":checked")&&$("input:radio[name='collection']").is(":checked")){e=$("input[name='product']:checked").val();t=$("input[name='collection']:checked").val();$("#selectProduct").html("<option value='"+e+"'>"+$("input[name='product']:checked").next().text()+"</option>");$("#selectCollection").html("<option value='"+t+"'>"+$("input[name='collection']:checked").next().text()+"</option>");y(i)}else{$("#selectColor").val("");i="";s=""}$("#colorSearchResults").toggle("slide",{direction:"left"})});$("#showSettingsWindow").click(function(){$(".setSettings").toggle("slide",{direction:"left"})});$("#cancelSettings, #closeSettingsWithArrow").click(function(){$(".setSettings").toggle("slide",{direction:"left"})});$("#saveSettings").click(function(){$(".setSettings").toggle("slide",{direction:"left"})});$("#showPriceInfoPopup").click(function(){if(a()){$("#priceInfoPopup").fadeIn()}else{$("#selectCanSizeError").fadeIn()}});$("#closePriceInfoPopup").click(function(){$("#priceInfoPopup").fadeOut()});$("#runTintingMachine").click(function(){if(a()){$("#runTintingMachinePopup").fadeIn()}else{$("#selectCanSizeError").fadeIn()}});$("#closeRunTintingMachinePopup").click(function(){$("#runTintingMachinePopup").fadeOut()});$("#printLabel").click(function(){console.log($("#selectCanSize").prop("selectedIndex"));if(a()){$("#printInfoPopup").fadeIn();console.log("show choose number of cans")}else{$("#selectCanSizeError").fadeIn();console.log("error - choose can size")}});$("#closeSelectCanSizeError").click(function(){$("#selectCanSizeError").fadeOut()});$("#closePrintInfoPopup").click(function(){$("#printInfoPopup").fadeOut()});$("#printLabelToPrinter").click(function(){$("#printInfoPopup").fadeOut();$("#printInfoPrintingToPrinter").fadeIn()});$("#closePrintInfoPrintingToPrinter").click(function(){$("#printInfoPrintingToPrinter").fadeOut()});$("#customCanSize").change(function(){if($.trim($("#customCanSize").val())!=""){$("#selectCanSize").prop("selectedIndex",0);r=-1}else{$("#customCanSize").val("")}});$("#selectCanSize").change(function(){r=$("#selectCanSize").val();if($("#selectCanSize").prop("selectedIndex")!=0){$("#customCanSize").val("");console.log(r);console.log($("#selectCanSize").text());S()}else{T()}});$("#clearCansize").click(function(){$("#customCanSize").val("")})})